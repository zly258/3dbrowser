!function(){"use strict";function e(e,t,n){const a=e.getUint32(n.value,!0);n.value+=4;const i=[];for(let l=0;l<a;l++){const a=e.getUint32(n.value,!0);n.value+=4;const l=e.getUint32(n.value,!0);n.value+=4;const o=new Float32Array(t.slice(n.value,n.value+12*a));n.value+=12*a;const u=new Float32Array(t.slice(n.value,n.value+12*a));n.value+=12*a;const s={position:o,normal:u,index:null};if(l>0){const e=new Uint32Array(t.slice(n.value,n.value+4*l));n.value+=4*l,s.index=e}i.push(s)}return i.some(e=>null!==e.index)&&i.forEach(e=>{if(!e.index){const t=e.position.length/3,n=new Uint32Array(t);for(let e=0;e<t;e++)n[e]=e;e.index=n}}),i}function t(e,t){const n=new Float32Array(16);for(let a=0;a<16;a++)n[a]=e.getFloat32(t.value,!0),t.value+=4;return n}self.onmessage=function(n){const{buffer:a,version:i,originalUuid:l,bimIdTable:o}=n.data;try{let n;n=i>=8?function(n,a,i){const l=new DataView(n),o={value:0},u=e(l,n,o),s=l.getUint32(o.value,!0);o.value+=4;const r=[];for(let e=0;e<s;e++){const e=l.getUint32(o.value,!0);o.value+=4,l.getUint32(o.value,!0),o.value+=4;const n=l.getUint32(o.value,!0);o.value+=4;const a=t(l,o),u=l.getUint32(o.value,!0);o.value+=4,r.push({bimId:i[e]??String(e),color:n,matrix:a,geoIdx:u})}return{geometries:u,instances:r,originalUuid:a}}(a,l,o||[]):function(n,a){const i=new DataView(n),l={value:0},o=e(i,n,l),u=i.getUint32(l.value,!0);l.value+=4;const s=[];for(let e=0;e<u;e++){const e=i.getUint32(l.value,!0);l.value+=4,i.getUint32(l.value,!0),l.value+=4;const n=i.getUint32(l.value,!0);l.value+=4;const a=t(i,l),o=i.getUint32(l.value,!0);l.value+=4,s.push({bimId:String(e),color:n,matrix:a,geoIdx:o})}return{geometries:o,instances:s,originalUuid:a}}(a,l);const u=[];n.geometries.forEach(e=>{e.position&&u.push(e.position.buffer),e.normal&&u.push(e.normal.buffer),e.index&&u.push(e.index.buffer)}),n.instances.forEach(e=>{e.matrix&&u.push(e.matrix.buffer)}),self.postMessage({type:"success",result:n},u)}catch(u){self.postMessage({type:"error",error:u.message||String(u)})}}}();
